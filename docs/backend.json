
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile within the BeMatch application.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The Firebase Authentication UID associated with this user."
        },
        "fullName": {
          "type": "string",
          "description": "The user's full name, max 14 characters.",
          "maxLength": 14
        },
        "dateOfBirth": {
          "type": "string",
          "description": "The user's date of birth.",
          "format": "date-time"
        },
        "gender": {
          "type": "string",
          "description": "The user's gender."
        },
        "showGenderOnProfile": {
          "type": "boolean",
          "description": "Whether to show the user's gender on their profile."
        },
        "genderPreference": {
          "type": "string",
          "enum": ["male", "female", "both"],
          "description": "The gender the user is interested in matching with."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "profilePicture": {
          "type": "string",
          "description": "URL of the user's main profile picture.",
          "format": "uri"
        },
        "media": {
          "type": "array",
          "description": "A list of media objects for the user's profile.",
          "items": {
            "type": "object",
            "properties": {
              "url": {
                "type": "string",
                "format": "uri"
              },
              "public_id": {
                "type": "string"
              },
              "type": {
                "type": "string",
                "enum": ["image", "video"]
              }
            }
          }
        },
        "interests": {
          "type": "array",
          "description": "A list of the user's interests.",
          "items": {
            "type": "string"
          }
        },
        "bio": {
          "type": "string",
          "description": "A short biography or description of the user, limited to 100 characters.",
          "maxLength": 100
        },
        "location": {
            "type": "object",
            "properties": {
                "latitude": {"type": "number"},
                "longitude": {"type": "number"}
            }
        },
        "address": {
          "type": "object",
          "description": "The user's address, derived from their location.",
          "properties": {
            "country": { "type": "string" },
            "countryCode": { "type": "string" },
            "city": { "type": "string" }
          }
        },
        "distancePreference": {
            "type": "number",
            "description": "Maximum distance in kilometers for potential matches."
        },
        "ageRange": {
            "type": "object",
            "properties": {
                "min": {"type": "number"},
                "max": {"type": "number"}
            },
            "description": "The preferred age range for matches."
        },
        "expandAgeRange": {
            "type": "boolean",
            "description": "Whether to show people outside the preferred age range if there are no matches."
        },
        "isOnline": {
            "type": "boolean",
            "description": "Indicates if the user is currently online."
        },
        "isGenderVerified": {
            "type": "boolean",
            "description": "Indicates if the user's gender has been verified by AI."
        },
        "lastSeen": {
            "type": "string",
            "format": "date-time",
            "description": "The last time the user was seen online."
        },
        "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp when the user profile was created."
        },
        "rulesAgreed": {
            "type": "boolean",
            "description": "Indicates if the user has agreed to the community rules."
        },
        "welcomeGiftClaimed": {
            "type": "boolean",
            "description": "Indicates if the user has claimed their initial welcome gift."
        },
        "isAdmin": {
            "type": "boolean",
            "description": "Indicates if the user has administrator privileges."
        },
        "superLikeBalance": {
            "type": "number",
            "description": "The number of Super Likes the user has available."
        },
        "membershipType": {
          "type": "string",
          "enum": ["free", "gold"],
          "description": "The user's membership tier."
        },
        "goldMembershipExpiresAt": {
          "type": "string",
          "format": "date-time",
          "description": "The user's Gold membership expires."
        },
        "dailyUndoCount": {
          "type": "number",
          "description": "The number of times a free user has used the undo feature today."
        },
        "lastUndoTimestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of the last undo action."
        }
      },
      "required": [
        "uid",
        "fullName",
        "dateOfBirth",
        "gender",
        "email"
      ]
    },
    "Match": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Match",
      "type": "object",
      "description": "Represents an interaction or match between two users.",
      "properties": {
        "user1Id": {
          "type": "string",
          "description": "The UID of the first user (lexicographically smaller)."
        },
        "user2Id": {
          "type": "string",
          "description": "The UID of the second user (lexicographically larger)."
        },
        "user1_action": {
          "type": "string",
          "enum": ["liked", "disliked", "superliked"],
          "description": "The action taken by user1."
        },
        "user1_timestamp": {
            "type": "string",
            "format": "date-time"
        },
        "user2_action": {
          "type": "string",
          "enum": ["liked", "disliked", "superliked"],
          "description": "The action taken by user2."
        },
        "user2_timestamp": {
            "type": "string",
            "format": "date-time"
        },
        "status": {
            "type": "string",
            "enum": ["pending", "matched", "superlike_pending"],
            "description": "The current status of the interaction."
        },
        "matchDate": {
          "type": "string",
          "description": "The date and time when the match was confirmed.",
          "format": "date-time"
        },
        "isSuperLike": {
            "type": "boolean",
            "description": "Indicates if this interaction was initiated with a Super Like."
        },
        "superLikeInitiator": {
          "type": "string",
          "description": "UID of the user who sent the Super Like."
        }
      },
      "required": [
        "user1Id",
        "user2Id"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a single message within a chat conversation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ChatMessage entity."
        },
        "matchId": {
          "type": "string",
          "description": "Reference to Match. (Relationship: Match 1:N ChatMessage)"
        },
        "senderId": {
          "type": "string",
          "description": "Reference to UserProfile who sent the message, or 'system'."
        },
        "text": {
          "type": "string",
          "description": "The text content of the message."
        },
        "imageUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL of an image sent in the message."
        },
        "imagePublicId": {
          "type": "string",
          "description": "Public ID of the image on Cloudinary for deletion."
        },
        "isViewOnce": {
          "type": "boolean",
          "description": "If true, the image can only be viewed once."
        },
        "viewed": {
            "type": "boolean",
            "description": "If true, the 'view once' image has been viewed."
        },
        "audioUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL of an audio message."
        },
        "audioDuration": {
            "type": "number",
            "description": "Duration of the audio message in seconds."
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time when the message was sent.",
          "format": "date-time"
        },
        "isRead": {
          "type": "boolean",
          "description": "Indicates if the message has been read by the recipient."
        },
        "readTimestamp": {
            "type": "string",
            "format": "date-time",
            "description": "The date and time when the message was read."
        },
        "type": {
          "type": "string",
          "enum": ["user", "system_superlike_prompt", "audio", "view-once", "view-once-viewed"],
          "description": "The type of message."
        },
        "action": {
          "type": "string",
          "enum": ["accepted", "declined"],
          "description": "Action taken on a system message."
        },
        "actionTaken": {
          "type": "boolean",
          "description": "Indicates if an action has been taken on the system message."
        },
        "isEdited": {
          "type": "boolean",
          "description": "Indicates if the message has been edited."
        },
        "editedAt": {
            "type": "string",
            "format": "date-time",
            "description": "The date and time when the message was last edited."
        }
      },
      "required": [
        "id",
        "matchId",
        "senderId",
        "timestamp",
        "isRead"
      ]
    },
    "Report": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report",
      "type": "object",
      "description": "Represents a user-submitted report against another user.",
      "properties": {
        "reporterId": {
          "type": "string",
          "description": "The UID of the user who submitted the report."
        },
        "reportedId": {
          "type": "string",
          "description": "The UID of the user being reported."
        },
        "matchId": {
          "type": "string",
          "description": "The ID of the match, if the report is related to a specific chat."
        },
        "reason": {
          "type": "string",
          "description": "The selected reason for the report."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the issue provided by the reporter."
        },
        "screenshotURL": {
          "type": "string",
          "format": "uri",
          "description": "URL of the screenshot provided as evidence."
        },
        "status": {
          "type": "string",
          "enum": ["pending", "resolved", "banned"],
          "description": "The current status of the report."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the report was submitted."
        }
      },
      "required": [
        "reporterId",
        "reportedId",
        "reason",
        "status",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/entities/UserProfile"
          },
          "description": "Stores public user profile data."
        }
      },
      {
        "path": "/matches/{matchId}",
        "definition": {
          "entityName": "Match",
          "schema": {
            "$ref": "#/entities/Match"
          },
          "description": "Stores interaction data (likes, dislikes, matches) between two users. The document ID is a composite key of the two user UIDs, sorted lexicographically."
        }
      },
      {
        "path": "/users/{userId}/matches/{matchId}",
        "definition": {
          "entityName": "Match",
          "schema": {
            "$ref": "#/entities/Match"
          },
          "description": "Stores denormalized data for confirmed matches for a specific user, allowing for easy querying of a user's match list."
        }
      },
      {
        "path": "/matches/{matchId}/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/entities/ChatMessage"
          },
          "description": "Stores chat messages for a specific confirmed match. Access is controlled by match membership."
        }
      },
      {
        "path": "/reports/{reportId}",
        "definition": {
          "entityName": "Report",
          "schema": {
            "$ref": "#/entities/Report"
          },
          "description": "Stores user-submitted reports for moderation."
        }
      }
    ]
  }
}
